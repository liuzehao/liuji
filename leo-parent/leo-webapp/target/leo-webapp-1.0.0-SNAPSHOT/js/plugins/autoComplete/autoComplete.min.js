(function(a){a.fn.extend({jcAutoComplete:function(i){var c=a.extend(true,{},a.fn.jcAutoComplete.defaults,i);var k=0;var w=0;var m;var t;var n=true;var r;var s;var q;var j=f();var o;var l=a("#autoTipImg");a(this).bind("keydown.autoComplete keyup.autoComplete blur.autoComplete",function(B){m=a(this);if(m.attr("readonly")){return}t=m.siblings("input[autoHidden=autoHidden]");p();var y=m.val().trim();var A=B.which;var z=B.type;var x=m.attr("flag");var C=m.attr("sql");C=C==undefined?"":C;if(z=="keydown"&&j[0].style.display!="none"){u(A)}if(z=="keyup"){if(B.ctrlKey||B.shiftKey||A==a.jcAutoComplete.keyCode.SHIFT){return}e(A)}if(z=="blur"&&n){m.val()==""&&d("");j.hide()}window.autoCompleteAjax=function(E,D){a.ajax({type:requestMethod.POST,url:D,dataType:"json",data:{keyword:y,sql:C,flag:x,isShowAll:E},error:function(){l.html("<span class='auo_text_warn'>数据返回错误！</span>")},success:function(F){if(F!=""){w=F.length;if(w>10){j.css({height:j.height(),overflowY:"scroll"})}l[0].innerHTML=h(F,y,E);o=j.find("div.itemDiv");j.show();m.focus();g();k=0;r=o.eq(0);v(undefined,r)}else{l.html("<span class='auo_text_warn'>未找到匹配数据！</span>");w=0}}})}});function p(){j.removeClass().addClass(m.attr("divClass")==undefined?"divauto":m.attr("divClass")).css({left:m.offset().left,top:m.offset().top+m.outerHeight(),height:"240px",overflowY:"auto",paddingLeft:0});var x=parseFloat(m.width())+parseFloat(m.css("paddingLeft").replace("px",""))+parseFloat(m.css("paddingRight").replace("px",""));j.width()<x&&j.width(x)}function e(y){if(m.val()!=""){if(y!=a.jcAutoComplete.keyCode.RIGHT&&y!=a.jcAutoComplete.keyCode.DOWN&&y!=a.jcAutoComplete.keyCode.LEFT&&y!=a.jcAutoComplete.keyCode.UP&&y!=a.jcAutoComplete.keyCode.ENTER&&y!=a.jcAutoComplete.keyCode.CONTROL){d("");j[0].style.display=="none"&&j.show();l.html("<span class='auo_text_loading'>正在获取数据……</span>");q!=undefined&&q!=null&&clearTimeout(q);var x=m.attr("reqUrl");x=x==undefined?"":x;if(x==""){window.autoCompleteURL=c.url}else{window.autoCompleteURL=x}q=setTimeout("autoCompleteAjax(false,window.autoCompleteURL)",c.delayTime)}}else{j.hide();d("")}}function u(x){if(x==a.jcAutoComplete.keyCode.RIGHT||x==a.jcAutoComplete.keyCode.DOWN){k=k+1>=w?0:k+1;s=o.eq(k);v(r,s);j.scrollTop((k-11)*20)}if(x==a.jcAutoComplete.keyCode.LEFT||x==a.jcAutoComplete.keyCode.UP){k=k<1?w-1:k-1;s=o.eq(k);v(r,s);j.scrollTop((k-11)*20)}if(x==a.jcAutoComplete.keyCode.ENTER||x==a.jcAutoComplete.keyCode.TAB){s=r;w!=0&&v(undefined,r,true);j.hide()}r=s}function g(){a("#isShowAll").unbind(".autoComplete").bind("mousedown.autoComplete",function(){l.html("<span class='auo_text_loading'>正在获取数据……</span>");autoCompleteAjax(true,c.url)});o.hover(function(){r=a(this);v(o.eq(k),r);k=o.index(this)},function(){v(a(this))}).unbind(".autoComplete").bind("mousedown.autoComplete",function(){v(undefined,a(this),true);j.hide()})}function h(C,z,E){var B="";for(var A=0;A<C.length;A++){var D=C[A].name;var y=D.replace(new RegExp(z,"i"),"<b><span style='color:red'>$&</span></b>");var x=C[A].id;B=B+"<div class='itemDiv' strId='"+x+"'>"+y+"</div>"}if(!E){B=B+"<div class='showAllDiv'><a id='isShowAll' class='auto_text_btn'>显示全部</a></div>"}return B}function v(y,z,x){y&&y.css({"background":"#FFFFFF"});if(z!==undefined){z.css({background:"#FBEC88"});if(x){m.val(z.text());d(z.attr("strId"))}}}function d(x){m.setJcAutoCompleteHiddenValue(x);t.val(x);if(c.selectedCallback){c.selectedCallback(m,t)}}function f(){a("#autoTipDiv").size()==0&&a("body").append("<div id='autoTipDiv' class='autoTipDiv'>"+'<iframe style="position:absolute; z-index:-1;width:110px;" frameborder="0" src="about:blank"></iframe>'+"<div id='autoTipImg'></div>"+"</div>");return a("#autoTipDiv").hover(function(){n=false},function(){n=true}).unbind(".autoComplete").bind("scroll.autoComplete",function(){m&&m.focus()})}return this},getJcAutoCompleteHiddenValue:function(){return this.data("hiddenValue")},setJcAutoCompleteHiddenValue:function(c){return this.data("hiddenValue",c)}});var b=(function(){var d=window.location+"";var e=d.split("//");var c=e[1].split("/");return e[0]+"//"+window.location.host+"/"+c[1]+"/"})();a.fn.jcAutoComplete.defaults={delayTime:0,selectedCallback:null,url:b+"autoComplete"};a.jcAutoComplete=function(){a("input[autocomplete],textarea[autocomplete]").unbind(".autoComplete").jcAutoComplete()};a.jcAutoComplete.keyCode={ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,F7:118,F12:123,S:83,WINDOWS:91}})(jQuery);$(function(){$.jcAutoComplete()});